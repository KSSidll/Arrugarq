services:
  android-build:
    build: .
    volumes:
      - ./signing.properties:/build/signing.properties
      - ./keystore.jks:/build/keystore.jks
      - ./app/release:/build/output
    command: >
      sh -c "
        rm -Rf __apk_build_repo__
        git clone https://github.com/KSSidll/Arru __apk_build_repo__ &&
        cp signing.properties __apk_build_repo__ &&
        cp keystore.jks __apk_build_repo__ &&
        cd __apk_build_repo__ &&
        git checkout 57c51ad34cff6ec9354930979956c841b2d2d4f1 &&
        chmod +x ./gradlew &&
        ./gradlew clean assembleRelease --no-build-cache --no-configuration-cache --no-daemon &&
        apksigner verify app/build/outputs/apk/release/app-release.apk &&
        rm -Rf /build/output/* &&
        cp -r app/build/outputs/apk/release/* /build/output
      "
